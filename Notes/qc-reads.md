在宏基因组测序分析的流程中，数据质控与过滤是至关重要的环节，它直接影响到后续分析结果的准确性和可靠性。
数据质控与过滤的核心目标:
1. 去除低质量数据：过滤掉测序质量低、错误率高的reads，提高数据的整体质量。
2. 过滤污染数据：包括接头序列污染、宿主基因组污染等，确保分析的是目标微生物群体的数据。
3. 保证数据的可靠性和完整性：在去除杂质的同时，尽可能保留有效的生物信息，避免数据的过度丢失。

## 原始数据评估
在进行质控与过滤之前，首先需要对原始数据进行全面的评估，了解数据的质量状况。常用的工具包括FastQC，它可以生成详细的报告，展示数据的各种质量指标，如碱基质量分布、GC含量、接头序列存在情况、序列长度分布等。通过这些指标，我们可以初步判断数据是否存在明显的质量问题，比如低质量的碱基比例过高、接头污染严重等。
```
fastqc --outdir fastqc_out \ # 输出目录
--threads 6 \ # 线程数
sample1_1.fq.gz  sample1_2.fq.gz # 输入文件
```
结果：
1.  网页版质控报告 fastqc.html  
2.  报告对应数据 fastqc.zip

## 低质量数据过滤
直接使用fastp 去除接头和低质量数据
```
fastp --thread 6 -i  sample1_1.fq.gz -I sample1_2.fq.gz  \
-o sample1_1.clean.fq.gz -O sample1_2.clean.fq.gz \
-h sample1.html
```

## 宿主污染过滤
对于人类样本或其他宿主相关的宏基因组测序，宿主基因组DNA往往占据了大量的比例，例如在人体肠道宏基因组测序中，宿主DNA可能会对微生物数据的分析产生干扰。因此，需要进行宿主污染过滤。常用的方法是将测序数据与宿主基因组数据库（如人类基因组hg38）进行比对，将比对到宿主基因组的reads过滤掉。可以使用Bowtie2、BWA等比对工具，通过设定严格的比对参数，高效地去除宿主污染的reads，保留目标微生物的序列数据。
```
# 构建宿主基因组index
bowtie2-build genome.fa  genome.db 
 
# bowtie2比对
bowtie2 --threads 6\ 
-x ./genome.db \ # 基因组index名称
-1 ./sample1_1.clean.fq.gz \ # 输入fq1
-2 .//sample1_2.clean.fq.gz \ # 输入fq2
-S sample1.sam \ # 输出sam格式
2>sample1.log
 
# 去除宿主数据
samtools view -f 12 \ # 去除比对上的reads
sample1.sam \ 
>sample1.unmap.bam # 输出bam格式文件
 
# bam转换回fq格式
samtools fastq \
-1 sample1_1.clean.fq.gz \ # 输出fq1
-2 sample1_2.clean.fq.gz \ # 输出fq2
sample1.unmap.bam # 输入bam文件
```

在完成数据质控与过滤后，需要再次对数据进行质量评估，以检验处理效果。评估指标与原始数据评估类似，包括Q20（碱基质量≥20的比例）、Q30（碱基质量≥30的比例）、GC含量、序列长度分布等。通过对比质控前后的数据统计，可以直观地看到低质量数据和污染数据的去除情况，以及有效数据的保留情况。例如，质控后Q20和Q30的比例应该有所提高，序列长度分布更加集中，接头污染和宿主污染的比例显著降低。